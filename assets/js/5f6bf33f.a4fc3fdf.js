"use strict";(self.webpackChunkdocs_v_1=self.webpackChunkdocs_v_1||[]).push([[2868],{5680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>y});var r=n(6540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(n),h=o,y=u["".concat(l,".").concat(h)]||u[h]||d[h]||a;return n?r.createElement(y,s(s({ref:t},c),{},{components:n})):r.createElement(y,s({ref:t},c))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:o,s[1]=i;for(var p=2;p<a;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8136:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>p});var r=n(8168),o=(n(6540),n(5680));const a={},s="Working with React Server Components",i={unversionedId:"tutorials/react-server-components/work-with-rsc",id:"tutorials/react-server-components/work-with-rsc",title:"Working with React Server Components",description:"Hydrogen 2.0 is out now. These archival Hydrogen 1.0 docs are provided only to assist developers during their upgrade process. Please migrate as soon as possible.",source:"@site/docs/tutorials/react-server-components/work-with-rsc.md",sourceDirName:"tutorials/react-server-components",slug:"/tutorials/react-server-components/work-with-rsc",permalink:"/hydrogen-v1/tutorials/react-server-components/work-with-rsc",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"hydrogen",previous:{title:"React Server Components overview",permalink:"/hydrogen-v1/tutorials/react-server-components/"},next:{title:"Routing",permalink:"/hydrogen-v1/tutorials/routing/"}},l={},p=[{value:"Fetching data on the server",id:"fetching-data-on-the-server",level:2},{value:"Example",id:"example",level:3},{value:"Fetching data on the client",id:"fetching-data-on-the-client",level:2},{value:"Sharing data between client and server",id:"sharing-data-between-client-and-server",level:2},{value:"Using <code>Context</code> in React Server Components",id:"using-context-in-react-server-components",level:2},{value:"Example",id:"example-1",level:3},{value:"Related hooks",id:"related-hooks",level:2},{value:"Next steps",id:"next-steps",level:2}],c={toc:p},u="wrapper";function d(e){let{components:t,...n}=e;return(0,o.yg)(u,(0,r.A)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"working-with-react-server-components"},"Working with React Server Components"),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"Hydrogen 2.0 is out now. These archival Hydrogen 1.0 docs are provided only to assist developers during their upgrade process. Please ",(0,o.yg)("a",{parentName:"p",href:"/migrate"},"migrate")," as soon as possible.")),(0,o.yg)("p",null,"This guide provides information about working with React Server Components in your Hydrogen app. To learn how React Server Components work in the context of Hydrogen, refer to ",(0,o.yg)("a",{parentName:"p",href:"/tutorials/react-server-components/"},"React Server Components overview"),"."),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},"Note:\nReact Server Components are currently in Alpha. However, Hydrogen includes a built-in layer of abstraction that provides stability, regardless of the state of React Server Components.")),(0,o.yg)("h2",{id:"fetching-data-on-the-server"},"Fetching data on the server"),(0,o.yg)("p",null,"All data fetching happens on the server and is never exposed to the client, unless you explicitly fetch data in a client component."),(0,o.yg)("p",null,"Hydrogen provides the following ways to fetch data from server components:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/hooks/global/useshopquery/"},(0,o.yg)("inlineCode",{parentName:"a"},"useShopQuery")),": A hook that makes server-only GraphQL queries to the Storefront API."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/hooks/global/fetchsync/"},(0,o.yg)("inlineCode",{parentName:"a"},"fetchSync")),": A hook that makes API requests and is the recommended way to make simple fetch calls on the server and the client."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/hooks/global/usequery/"},(0,o.yg)("inlineCode",{parentName:"a"},"useQuery")),": A hook that executes an asynchronous operation like ",(0,o.yg)("inlineCode",{parentName:"li"},"fetch")," in a way that supports ",(0,o.yg)("a",{parentName:"li",href:"https://reactjs.org/docs/concurrent-mode-suspense.html/"},"Suspense"),". You can use this function to call any third-party APIs or perform any async tasks.")),(0,o.yg)("p",null,"To learn how to fetch data from third-party sources, refer to ",(0,o.yg)("a",{parentName:"p",href:"/tutorials/data-sources/"},"Data sources"),"."),(0,o.yg)("h3",{id:"example"},"Example"),(0,o.yg)("p",null,"The following example shows a server component (",(0,o.yg)("inlineCode",{parentName:"p"},"Product.server.jsx"),") that uses the ",(0,o.yg)("inlineCode",{parentName:"p"},"useShopQuery")," hook to fetch data. The data is passed to a client component (",(0,o.yg)("inlineCode",{parentName:"p"},"WishListButton.client.jsx"),") that uses state:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"// Product.server.jsx\n\nimport {useShopQuery} from '@shopify/hydrogen';\nimport WishListButton from './WishListButton.client';\n\nexport default function Product() {\n  const {data} = useShopQuery({query: QUERY});\n\n  return (\n    <section>\n      <h1>{data.product.title}</h1>\n      <WishListButton product={data.product} />\n    </section>\n  );\n}\n")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"// WishListButton.client.jsx\n\nimport {useState} from 'react';\n\nexport default function WishListButton({product}) {\n  const [added, setAddToWishList] = useState(false);\n\n  return (\n    <button onClick={() => setAddToWishList(!added)} type=\"button\">\n      {added ? 'Added' : 'Add'} {product.title} to Wish List\n    </button>\n  );\n}\n")),(0,o.yg)("h2",{id:"fetching-data-on-the-client"},"Fetching data on the client"),(0,o.yg)("p",null,"To make a third-party HTTP request on the client, use the ",(0,o.yg)("a",{parentName:"p",href:"/hooks/global/fetchsync/"},(0,o.yg)("inlineCode",{parentName:"a"},"fetchSync"))," hook within a Suspense boundary:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"// PostDetails.client.jsx\n\nimport {fetchSync} from '@shopify/hydrogen';\nimport {Suspense, useState} from 'react';\nexport default function PostDetails() {\n  const [show, setShow] = useState(false);\n  return (\n    <>\n      <button onClick={() => setShow(!show)} type=\"button\">\n        Show Details\n      </button>\n      {show && (\n        <Suspense fallback=\"Loading\">\n          <Details>\n        </Suspense>\n      }\n    </>\n  );\n}\nfunction Details() {\n  const post = fetchSync('https://3p.api.com/post.json').json();\n  return <h2>{post.title}</h2>;\n}\n")),(0,o.yg)("p",null,"Some third-party integrations offer a JavaScript SDK in the form of an ",(0,o.yg)("inlineCode",{parentName:"p"},"npm")," package. You can use Hydrogen's ",(0,o.yg)("inlineCode",{parentName:"p"},"suspendFunction")," utility to create a version of the SDK which supports Suspense data-fetching:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"// PostDetails.client.jsx\n\nimport {suspendFunction} from '@shopify/hydrogen';\nimport {Suspense, useState} from 'react';\nimport thirdPartyClient from 'third-party';\nexport default function PostDetails() {\n  const [show, setShow] = useState(false);\n  return (\n    <>\n      <button onClick={() => setShow(!show)} type=\"button\">\n        Show Details\n      </button>\n      {show && (\n        <Suspense fallback=\"Loading\">\n          <Details>\n        </Suspense>\n      }\n    </>\n  );\n}\nfunction fetchThirdParty(opts) {\n  return suspendFunction(['unique', 'key'], async () => {\n    return await thirdPartyClient.query(opts)\n  });\n}\nfunction Details() {\n  const post = fetchThirdParty('myPost');\n  return <h2>{post.title}</h2>;\n}\n")),(0,o.yg)("h2",{id:"sharing-data-between-client-and-server"},"Sharing data between client and server"),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},"Note:\nThe functionality described in this section is unique to Hydrogen's React Server Components implementation.")),(0,o.yg)("p",null,"Hydrogen provides a ",(0,o.yg)("a",{parentName:"p",href:"/tutorials/server-props/"},(0,o.yg)("inlineCode",{parentName:"a"},"useServerProps()")," hook with a ",(0,o.yg)("inlineCode",{parentName:"a"},"setServerProps()")," helper function"),", which allows you to re-render server components with new data. You can use ",(0,o.yg)("inlineCode",{parentName:"p"},"setServerProps()")," for UI states that shouldn't persist in the URL. Any data set with ",(0,o.yg)("inlineCode",{parentName:"p"},"setServerProps()")," will be reset when the user navigates to a new page."),(0,o.yg)("h2",{id:"using-context-in-react-server-components"},"Using ",(0,o.yg)("inlineCode",{parentName:"h2"},"Context")," in React Server Components"),(0,o.yg)("p",null,"React developers commonly use ",(0,o.yg)("a",{parentName:"p",href:"https://reactjs.org/docs/context.html"},(0,o.yg)("inlineCode",{parentName:"a"},"Context"))," to share state among many different components in a render tree, without having to drill props down to each individual component."),(0,o.yg)("p",null,"Currently, you can't use ",(0,o.yg)("inlineCode",{parentName:"p"},"Context")," inside server components because server context isn't yet available in React. However, you can use ",(0,o.yg)("inlineCode",{parentName:"p"},"Context")," inside client components."),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},"Note:\nThe ",(0,o.yg)("inlineCode",{parentName:"p"},"ShopifyProvider")," component is a server component that renders inside ",(0,o.yg)("inlineCode",{parentName:"p"},"App.server.jsx"),". ",(0,o.yg)("inlineCode",{parentName:"p"},"ShopifyProvider")," is specific to Hydrogen and currently doesn't work in Next.js or other frameworks.")),(0,o.yg)("h3",{id:"example-1"},"Example"),(0,o.yg)("p",null,"The following example shows how to use ",(0,o.yg)("inlineCode",{parentName:"p"},"Context")," in the ",(0,o.yg)("inlineCode",{parentName:"p"},"CartProvider")," client component:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"// CartContext.client.jsx\n\nconst CartAppContext = createContext();\n\nexport default CartAppContext;\n\nexport function useCartContext() {\n  const context = useContext(CartAppContext);\n\n  if (!context) {\n    throw new Error('No cart context found');\n  }\n\n  return context;\n}\n")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"// CartProvider.client.jsx\n\nimport {CartContext} from './CartContext.client';\n\nexport default function CartProvider({items, children}) {\n  const value = {\n    items,\n    // ...\n  };\n\n  return <CartContext.Provider value={value}>{children}</CartContext.Provider>;\n}\n")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"// App.server.jsx\n\nimport CartProvider from './CartProvider.client';\n\nexport default function App() {\n  const {data} = useShopQuery({query: QUERY});\n\n  return (\n    <CartProvider data={data.cart}>\n      <p>Your app here</p>\n    </CartProvider>\n  );\n}\n")),(0,o.yg)("h2",{id:"related-hooks"},"Related hooks"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/hooks/global/useshopquery/"},(0,o.yg)("inlineCode",{parentName:"a"},"useShopQuery"))),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/hooks/global/fetchsync/"},(0,o.yg)("inlineCode",{parentName:"a"},"fetchSync"))),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/hooks/global/usequery/"},(0,o.yg)("inlineCode",{parentName:"a"},"useQuery"))),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/hooks/global/useserverprops/"},(0,o.yg)("inlineCode",{parentName:"a"},"useServerProps")))),(0,o.yg)("h2",{id:"next-steps"},"Next steps"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Improve your app's loading performance with ",(0,o.yg)("a",{parentName:"li",href:"/tutorials/streaming-ssr/"},"streaming SSR and Suspense"),"."),(0,o.yg)("li",{parentName:"ul"},"Learn about how Hydrogen consumes data from different ",(0,o.yg)("a",{parentName:"li",href:"/tutorials/data-sources/"},"sources"),".")))}d.isMDXComponent=!0}}]);