"use strict";(self.webpackChunkdocs_v_1=self.webpackChunkdocs_v_1||[]).push([[4144],{5680:(e,t,r)=>{r.d(t,{xA:()=>p,yg:()=>h});var o=r(6540);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=o.createContext({}),c=function(e){var t=o.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},y=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(r),y=n,h=u["".concat(l,".").concat(y)]||u[y]||d[y]||a;return r?o.createElement(h,s(s({ref:t},p),{},{components:r})):o.createElement(h,s({ref:t},p))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,s=new Array(a);s[0]=y;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:n,s[1]=i;for(var c=2;c<a;c++)s[c]=r[c];return o.createElement.apply(null,s)}return o.createElement.apply(null,r)}y.displayName="MDXCreateElement"},6567:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var o=r(8168),n=(r(6540),r(5680));const a={},s="Incrementally adopt Hydrogen with route proxies",i={unversionedId:"tutorials/proxy-routes-to-online-store",id:"tutorials/proxy-routes-to-online-store",title:"Incrementally adopt Hydrogen with route proxies",description:"Hydrogen 2.0 is out now. These archival Hydrogen 1.0 docs are provided only to assist developers during their upgrade process. Please migrate as soon as possible.",source:"@site/docs/tutorials/proxy-routes-to-online-store.md",sourceDirName:"tutorials",slug:"/tutorials/proxy-routes-to-online-store",permalink:"/hydrogen-v1/tutorials/proxy-routes-to-online-store",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"hydrogen",previous:{title:"ESLint",permalink:"/hydrogen-v1/tutorials/eslint"},next:{title:"Querying data in Hydrogen",permalink:"/hydrogen-v1/tutorials/querying/"}},l={},c=[{value:"Limitations",id:"limitations",level:2},{value:"Sample code",id:"sample-code",level:2},{value:"Sharing carts",id:"sharing-carts",level:2},{value:"Step 1: Detect active carts",id:"step-1-detect-active-carts",level:3},{value:"Step 2: Switch to the Storefront API for carts",id:"step-2-switch-to-the-storefront-api-for-carts",level:3},{value:"Step 3: Proxy to the Online Store",id:"step-3-proxy-to-the-online-store",level:3}],p={toc:c},u="wrapper";function d(e){let{components:t,...r}=e;return(0,n.yg)(u,(0,o.A)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"incrementally-adopt-hydrogen-with-route-proxies"},"Incrementally adopt Hydrogen with route proxies"),(0,n.yg)("admonition",{type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"Hydrogen 2.0 is out now. These archival Hydrogen 1.0 docs are provided only to assist developers during their upgrade process. Please ",(0,n.yg)("a",{parentName:"p",href:"/migrate"},"migrate")," as soon as possible.")),(0,n.yg)("p",null,"Some merchants want to adopt Hydrogen incrementally. For example, they might want to use the online store only for product pages and Hydrogen for everything else."),(0,n.yg)("p",null,"This guide explains how to adopt Hydrogen incrementally by proxying certain routes to the online store."),(0,n.yg)("h2",{id:"limitations"},"Limitations"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Proxying routes is only supported on Oxygen. This is temporary.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"You can't share customer sessions."))),(0,n.yg)("h2",{id:"sample-code"},"Sample code"),(0,n.yg)("p",null,"The following code is an example of proxying product page requests to the online store:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-jsx"},'// src/routes/products/[handle].server.jsx\n\nexport async function api(request, { params }) {\n  // This approach is only supported by Oxygen\n  const { handle } = params;\n  const response = await fetch("https://{shop}.myshopify.com/products/" + handle, {\n    headers: {\n      // It\'s important to set or forward a User-Agent, otherwise the online store might block the request\n      \'User-Agent\': \'Hydrogen\',\n    },\n  });\n  const data = await response.text();\n  return new Response(data, { headers: { "content-type": "text/html" } });\n}\n')),(0,n.yg)("h2",{id:"sharing-carts"},"Sharing carts"),(0,n.yg)("p",null,"Currently, Liquid carts and Storefront API carts are separate. You can't query a Liquid cart through the Storefront API, or access a Storefront API-created cart through Liquid. We\u2019re completing a project to address this. Soon, we'll enable you to use a cart ID from the online store to manage a Storefront API cart. Until then, you can share carts using the following steps:"),(0,n.yg)("h3",{id:"step-1-detect-active-carts"},"Step 1: Detect active carts"),(0,n.yg)("p",null,"Hydrogen uses the Storefront API to manage carts. You need to update the online store theme to also use the Storefront API for carts. Liquid carts live for ten days, so switching to the Storefront API cart could result in customers losing their active carts."),(0,n.yg)("p",null,"To prevent this, you need to detect whether a customer is using a Liquid cart or a Storefront API cart and handle both scenarios for ten days. If a cart cookie exists, then the customer has an active Liquid cart."),(0,n.yg)("p",null,"The following image illustrates a cart cookie, which indicates an active Liquid cart:"),(0,n.yg)("p",null,"{{ '/custom-storefronts/hydrogen/liquid-cart-cookie.png' | image: alt: 'Dev tools in a browser showing Cookies, with a cart cookie highlighted.' }}"),(0,n.yg)("h3",{id:"step-2-switch-to-the-storefront-api-for-carts"},"Step 2: Switch to the Storefront API for carts"),(0,n.yg)("p",null,"Update the online store theme to use the Storefront API for carts. You'll need to run the Storefront API and Liquid carts side-by-side for ten days to avoid losing any active carts."),(0,n.yg)("p",null,"Hydrogen stores a Storefront API cart ID in local storage under the ",(0,n.yg)("inlineCode",{parentName:"p"},"shopifyCartId")," key. Use the same key to manage your cart and Hydrogen will pick it up automatically when you make the switch. You must create the cart/key if it doesn\u2019t exist, because customers might arrive on a proxied page first."),(0,n.yg)("p",null,"{{ '/custom-storefronts/hydrogen/hydrogen-local-storage-cart-id.png' | image: alt: 'Dev tools in a browser showing Local Storage. The Storefront API cart URL is selected, and the window displays the key ",(0,n.yg)("inlineCode",{parentName:"p"},"shopifycartId")," and a gid.' }}"),(0,n.yg)("h3",{id:"step-3-proxy-to-the-online-store"},"Step 3: Proxy to the Online Store"),(0,n.yg)("p",null,"The following code example shows how to proxy product page requests to the online store:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-jsx"},'// src/routes/products/[handle].server.jsx\n\nexport async function api(request, { params }) {\n  // This approach is only supported by Oxygen\n  const { handle } = params;\n  const response = await fetch("https://{shop}.myshopify.com/products/" + handle, {\n    headers: {\n      // It\'s important to set or forward a User-Agent, otherwise the online store might block the request\n      \'User-Agent\': \'Hydrogen\',\n    },\n  });\n  const data = await response.text();\n  return new Response(data, { headers: { "content-type": "text/html" } });\n}\n')),(0,n.yg)("p",null,"Ensure that you test the implementation before directing all of your traffic to the Hydrogen site."))}d.isMDXComponent=!0}}]);