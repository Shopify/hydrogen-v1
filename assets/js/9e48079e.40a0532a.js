"use strict";(self.webpackChunkdocs_v_1=self.webpackChunkdocs_v_1||[]).push([[5079],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var a=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,o=function(e,t){if(null==e)return{};var r,a,o={},n=Object.keys(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var r=e.components,o=e.mdxType,n=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(r),c=o,m=d["".concat(l,".").concat(c)]||d[c]||h[c]||n;return r?a.createElement(m,i(i({ref:t},p),{},{components:r})):a.createElement(m,i({ref:t},p))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=r.length,i=new Array(n);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,i[1]=s;for(var u=2;u<n;u++)i[u]=r[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}c.displayName="MDXCreateElement"},3242:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>n,metadata:()=>s,toc:()=>u});var a=r(7462),o=(r(7294),r(3905));const n={},i="Preloaded queries",s={unversionedId:"tutorials/querying/preloaded-queries",id:"tutorials/querying/preloaded-queries",title:"Preloaded queries",description:"Hydrogen 2.0 is out now. These archival Hydrogen 1.0 docs are provided only to assist developers during their upgrade process. Please migrate to Hydrogen 2.0 as soon as possible.",source:"@site/docs/tutorials/querying/preloaded-queries.md",sourceDirName:"tutorials/querying",slug:"/tutorials/querying/preloaded-queries",permalink:"/tutorials/querying/preloaded-queries",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"hydrogen",previous:{title:"Preload queries",permalink:"/tutorials/querying/preload-queries"},next:{title:"React Server Components overview",permalink:"/tutorials/react-server-components/"}},l={},u=[{value:"How preloaded queries work",id:"how-preloaded-queries-work",level:2},{value:"Disabling preloaded queries",id:"disabling-preloaded-queries",level:3},{value:"Routes with parameters",id:"routes-with-parameters",level:3},{value:"Preload everywhere",id:"preload-everywhere",level:2},{value:"Debug query timings",id:"debug-query-timings",level:2},{value:"Related components and hooks",id:"related-components-and-hooks",level:2},{value:"Next steps",id:"next-steps",level:2}],p={toc:u},d="wrapper";function h(e){let{components:t,...r}=e;return(0,o.kt)(d,(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"preloaded-queries"},"Preloaded queries"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Hydrogen 2.0 is out now. These archival Hydrogen 1.0 docs are provided only to assist developers during their upgrade process. Please ",(0,o.kt)("a",{parentName:"p",href:"https://shopify.dev/docs/custom-storefronts/hydrogen/migrate-hydrogen-remix"},"migrate to Hydrogen 2.0")," as soon as possible.")),(0,o.kt)("aside",{class:"note beta"},(0,o.kt)("h4",null,"Experimental feature"),(0,o.kt)("p",null,"Preloaded queries is an experimental feature. As a result, functionality is subject to change. You can provide feedback on this feature by ",(0,o.kt)("a",{href:"https://github.com/Shopify/hydrogen/issues"},"submitting an issue in GitHub"),".")),(0,o.kt)("p",null,"This guide provides information on how preloaded queries work in your Hydrogen app."),(0,o.kt)("h2",{id:"how-preloaded-queries-work"},"How preloaded queries work"),(0,o.kt)("p",null,"Preloaded queries allow your Hydrogen app to discover and preload nested queries within a page."),(0,o.kt)("p",null,"In the following diagram, none of the queries (",(0,o.kt)("inlineCode",{parentName:"p"},"shopInfo"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"CollectionDetails"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"layoutContent"),", or ",(0,o.kt)("inlineCode",{parentName:"p"},"Localization"),") have been preloaded:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://shopify.dev/assets/custom-storefronts/hydrogen/preload-queries-none-set.png",alt:"Shows a diagram of queries that haven't been preloaded"})),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"shopInfo")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"CollectionDetails")," queries must finish loading before ",(0,o.kt)("inlineCode",{parentName:"p"},"layoutContent")," can start. Subsequently, ",(0,o.kt)("inlineCode",{parentName:"p"},"layoutContent")," must finish loading before ",(0,o.kt)("inlineCode",{parentName:"p"},"localization")," can start. This behavior is called a request waterfall, and it can severely reduce your app performance."),(0,o.kt)("p",null,"Because none of these queries have dependencies, it would be ideal if they all started to load in parallel up front. This process is called preloading queries, and Hydrogen does it by default:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://shopify.dev/assets/custom-storefronts/hydrogen/preload-queries-set.png",alt:"Shows a diagram of queries that have been preloaded"})),(0,o.kt)("p",null,"Preloaded queries work by storing the query fetcher for the next time the same URL is requested. The first time a route is loaded, no queries are preloaded. The second time a route is loaded, Hydrogen remembers which queries were necessary to render the same route."),(0,o.kt)("h3",{id:"disabling-preloaded-queries"},"Disabling preloaded queries"),(0,o.kt)("p",null,"By default, all cached queries are preloaded. However, not all queries should be preloaded. For example, any query that returns personalized results shouldn't be preloaded. Just like caching personalized queries, preloading personalized queries can disperse data across requests."),(0,o.kt)("p",null,"In development mode, Hydrogen detects request waterfalls, and warns you that the query isn't preloaded:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://shopify.dev/assets/custom-storefronts/hydrogen/suspense-waterfall.png",alt:"Shows a screenshot of request waterfall warning"})),(0,o.kt)("p",null,"Learn how to ",(0,o.kt)("a",{parentName:"p",href:"/tutorials/querying/preload-queries#disable-preloaded-queries"},"disable preloaded queries"),"."),(0,o.kt)("h3",{id:"routes-with-parameters"},"Routes with parameters"),(0,o.kt)("p",null,"Preloaded queries work similarly for routes with parameters, like ",(0,o.kt)("inlineCode",{parentName:"p"},"Product")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Collection"),", except that each route with a different parameter has its own preloaded queries."),(0,o.kt)("p",null,"For example, the first time a user visits ",(0,o.kt)("inlineCode",{parentName:"p"},"/collections/freestyle-collection"),", no queries will be preloaded. Similarly, the first time a user visits ",(0,o.kt)("inlineCode",{parentName:"p"},"/collections/backcountry-collection"),", no queries will be preloaded. However, the second time that a user visits either route, queries will be preloaded. It's important that each route has separate preloaded queries, otherwise the results of one might show up for the results of the other."),(0,o.kt)("h2",{id:"preload-everywhere"},"Preload everywhere"),(0,o.kt)("p",null,"You can tell Hydrogen to ",(0,o.kt)("a",{parentName:"p",href:"/tutorials/querying/preload-queries#preload-everywhere"},"preload a query everywhere"),". This option can be helpful for menu links in your navigation, because it allows you to preload a query on button click or while you animate a transition to another page."),(0,o.kt)("h2",{id:"debug-query-timings"},"Debug query timings"),(0,o.kt)("aside",{class:"note beta"},(0,o.kt)("h4",null,"Experimental feature"),(0,o.kt)("p",null,"The `showQueryTiming` property is an experimental feature. As a result, functionality is subject to change. You can provide feedback on this feature by ",(0,o.kt)("a",{href:"https://github.com/Shopify/hydrogen/issues"},"submitting an issue in GitHub"),".")),(0,o.kt)("p",null,"If you have a suspense waterfall detected, then you can log request timing information by enabling the ",(0,o.kt)("inlineCode",{parentName:"p"},"logger.showQueryTiming")," property in your ",(0,o.kt)("a",{parentName:"p",href:"/tutorials/configuration/#logger"},"Hydrogen configuration file"),"."),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"/tutorials/configuration/#logger"},(0,o.kt)("inlineCode",{parentName:"a"},"showQueryTiming"))," property logs the timeline of when queries are being requested, resolved, and rendered. If a query is preloaded, but isn't being used, then a warning displays in the server log:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://shopify.dev/assets/custom-storefronts/hydrogen/preload-query-warning.png",alt:"Shows a screenshot of preloaded query warning"})),(0,o.kt)("p",null,"If a query is being double loaded, then a warning displays in the server log. This error typically happens when the preloaded query isn't the same query as the one requested:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://shopify.dev/assets/custom-storefronts/hydrogen/double-loaded-query.png",alt:"Shows a screenshot of query being double loaded"})),(0,o.kt)("h2",{id:"related-components-and-hooks"},"Related components and hooks"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/components/global/shopifyprovider/"},(0,o.kt)("inlineCode",{parentName:"a"},"ShopifyProvider"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/hooks/global/fetchsync/"},(0,o.kt)("inlineCode",{parentName:"a"},"fetchSync"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/hooks/global/useshopquery/"},(0,o.kt)("inlineCode",{parentName:"a"},"useShopQuery"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/hooks/global/usequery/"},(0,o.kt)("inlineCode",{parentName:"a"},"useQuery")))),(0,o.kt)("h2",{id:"next-steps"},"Next steps"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Learn how to perform common tasks for ",(0,o.kt)("a",{parentName:"li",href:"/tutorials/querying/preload-queries/"},"preloading queries"),"."),(0,o.kt)("li",{parentName:"ul"},"Learn about the ",(0,o.kt)("a",{parentName:"li",href:"/tutorials/analytics/"},"analytics support")," built into Hydrogen.")))}h.isMDXComponent=!0}}]);